<?php

declare(strict_types=1);

namespace App\Tests\Stub;

use App\Domain\Candle\Enum\CandleIntervalEnum;
use App\TechnicalAnalysis\Application\Contract\FindAveragePriceChangeResult;
use App\TechnicalAnalysis\Application\Contract\TechnicalAnalysisToolsFactoryInterface;
use App\TechnicalAnalysis\Application\Service\TechnicalAnalysisTools;
use App\TechnicalAnalysis\Application\Service\TechnicalAnalysisToolsInterface;
use App\Trading\Domain\Symbol\SymbolInterface;
use RuntimeException;

final class TechnicalAnalysisToolsStub implements TechnicalAnalysisToolsInterface
{
    /** @var array<array{symbol: SymbolInterface, onInterval:CandleIntervalEnum, tools: TechnicalAnalysisToolsInterface}> */
    private array $data = [
        'averagePriceChange' => [],
        'averagePriceChangePrev' => [],
    ];

    public function __construct(
        public SymbolInterface $symbol,
        public CandleIntervalEnum $onInterval,
    ) {
    }

    public function addAveragePriceChangeResult(
        int $intervalsCount,
        FindAveragePriceChangeResult $result,
    ): void {
        if (isset())
        foreach ($this->data as $item) {
            if (
                $item['tools']->getSymbol() === $symbol
                && $item['onInterval'] === $candleIntervalEnum
            ) {
                $too
            }
        }


        $this->data[] = [
            'symbol' => $symbol,
            'onInterval' => $candleIntervalEnum,
            'tools' => $tools,
        ];
    }

    public function __call(
        string $name,
        array $arguments
    ) {
        // TODO: Implement __call() method.
    }

    public function create(
        SymbolInterface $symbol,
        ?CandleIntervalEnum $candleIntervalEnum = null
    ): TechnicalAnalysisTools {
        foreach ($this->data as $item) {
            if (
                $item['symbol']->name() === $symbol->name()
                && $item['onInterval'] === $candleIntervalEnum
            ) {
                var_dump($item);die;
                $tools = $item['tools'];

                if ($item['onInterval']) {
                    $tools->withInterval($item['onInterval']);
                }

                return $tools;
            }
        }

        throw new RuntimeException('Cannot find mocked tools');
    }
}
