imports
    - { todos }

### Dump ###
    @todo | check if sequence rewinds to and move back to restore also id

### Tests ###
    ExchangeOrderTest.php
    PositionBuilderTest.php

### ??? ###
    src/Infrastructure/Cache/PositionsCache.php
    cals
    написать compByHedge
    src/modules/Bot/Application/Messenger/Job/Utils/FixupOrdersDoublingHandler.php

        /**
         * equiv hedge from BuyAndCheckFurtherPositionLiquidation
         * eth Buy
         * $liquidationPrice =
         * $withPrice =
         * $safePriceDistance =
         */

### Monitoring ###
    metrics
        e.g. PushAllMainPositionsStopsHandler exec time deviation

### Api fetching ###
    @todo | crash | it will crash in case of opened position on symbol not presented in Symbol.php
    @todo | cache | all symbols?

### Orders context promotion ###
    @todo | stop | isCloseByMarketContextSet | if support

### Liquidation ###
    @todo | liquidation
    @todo | liquidation | corner cases
    @todo | liquidation | too big additional stop
    liq strategy based on safePriceDistance (or add some to liquidation distance)
    lP history points (and average through period)
        to determine what delta must be used in moment

### Other / Minor ###
    #####!!!! UI !!!!!#####
            @todo | UI | parameters | add some description and print in `show` command

    symbols_wip_from_main_before_new_m
    main_msg_with_critical_context.patch / Тут пытался делать что-то по поводу скипа сообщений PushOrders
    @todo | liquidation
    @todo | liquidation | null
    @todo | check | other | reserved balance
    @todo | profit | it's not about leverage ...
    tests/Unit/Domain/Position/Helper/PositionCloneTest.php
    Commands
        increase position (by some paams)
        buy grid for specified volume (that will be divided to some orders qnt and size)

### Cache ###
    @todo | cache
    @todo | cache | pass specific cache ttl?
    @todo | cache | all symbols?

### Checks ###
    @todo | sandbox | mb troubles with sandbox (inner check will not work)
    @todo | buy/check
    @todo | buy/check | situation when position became main after buy
    @todo | stop/check
    Some command to see checks failures?
    veryHardPriceAv

### Docs ###
    !!! SafePriceDistanceSettings.md !!!

### Async problems? ###
    @todo manual release events

### Performance ###
    some settings can be initialized once
    @todo publish to async
    + @todo | performance | rid of Percent if can

### Hedge ###
    hedge as grid creates order in strange range
    @todo | take early stopped part into account

### Parameters ###
    safePriceDistance
        safe price strategy by defined level

### Settings ###
    @todo | settings
    @todo | settings | tests
    @todo | performance | settings | slow cache or db? or foreach
    @todo specify array of parameters to evaluate after edit
    default settings values
        if ($this->settings->required(ConnectionSettings::CheckConnectionEnabled) !== true) {

### Validation ###
    @todo StrictPercent vs CommonPercent

### AllOpenedPositionsInfoCommand ###
    @todo | UI | opened-positions | Capture specific position state to cache?
    @todo | AllOpenedPositionsInfoCommand
    @todo | AllOpenedPositionsInfoCommand | when liquidation placed before entry
    @todo | AllOpenedPositionsInfoCommand | research error
    @todo | AllOpenedPositionsInfoCommand | stops found before ticker not executed (due to big mark/index difference)
    @todo | AllOpenedPositionsInfoCommand | sort by changes
    @todo | AllOpenedPositionsInfoCommand| какое значение использовать для $mainPosStopsApplicableRange = PriceRange::create($boundBeforeLiquidation, $tickerBound, $position->symbol); ?
        criticalRange->to тоже не совсем верно

### Push ###
    + @todo | stop check mainPosition stops first
    @todo | pushStops
    @todo manual release events
    @todo | all-main | if not in warn/crit // and get without cache if in crit/warn
    @todo | sandbox | mb troubles with sandbox (inner check will not work)

        ~~~ Orders ~~~
            @todo | stop
            @todo | buy
            @todo | buy | round here?
            specify initial pnlDistance on SLs creation + periodical check new liquidation for move orders according to initial relative distance

### Forgotten Errors ###
    @todo | liquidation | log into app_errors?
    @todo | exceptions
    !!!!!!!fix!!!!! manual | short liq distance / ticker right before liquidation (in critical range)

### SymbolPrice ###
    @todo | price | handle exception
    @todo | ctrl-f: round(..., 2)

### Sandbox ###
    tests/Unit/Application/UseCase/Trading/Sandbox/TradingSandbox/OtherSandboxTests.php
    regexp CTRL-F: @todo.*sandbox
    @todo | sandbox | mb troubles with sandbox (inner check will not work)
    @todo | sandbox | research impact on balance
    @todo | sandbox | get rid of SandboxState::getAvailableBalance or replace logic based on SandboxState::contractBalance
    @todo | sandbox | add unrealizedPNL (isUTA)
    @todo | sandbox | what to use? position entry or stop price

### Upgrade ###
    postgres 16

### DRY ###
    @todo | DRY | with OpenPositionHandler
    @todo some `actualStopsRangeBoundNearestToPositionLiquidation`

### Statistics ###
    save ticker every minute
        check if symbol hedge other on some distance
    position open/close datetime

### openedPositions ###
    save current passed distance

front + liq chart
analise average price change through some period
    => safePriceDistance
    => significantPrice change (accurately for same period). E.g. x5 from common change
    => ...
    => auto swipe hedge criteria
    => profit criteria
    => move stops parameters

### PriceChange ###
    @todo | priceChange | some very short period handler
    @todo | priceChange | save prev percent and notify again if new percent >= prev
    @todo | priceChange | +/-

    [ui] Screener -> dash (top volatility)

### Trading ###
    remove stale stops (after position close)
    `AkaLimitOrder` entity + some threshold for not lost the trade

    Auto
        1. TradingSetupDto ...
        2. decisions by market volume at candle?
        3. some level finder
            google

            wait with trend
                https://www.youtube.com/watch?v=HOwqznGsX88
            close on opposite

            3.1 try free spot exchanges api
                + https://youtu.be/_1JaRsXuSb8?t=866

### Schema ###
    do d:m:d and add constraints


### Symbol###
    @todo | symbols | profiling
    @todo | symbol | performance
        check queries (EAGER)
        symbolProvider profiling
    @todo | symbol | some way to get values based on symbol -> move to settings?
    @todo | symbol | for all symbols
    @todo | symbols | TakeProfit trigger delta (and whole mechanics) for all symbols

### !!! MAIN !!! ###
    [symbol] @todo | symbol | TRY TO OPEN SOME UNSUPPORTED POSITON ON TESTNET (UnsupportedAssetCategoryException, QuoteCoinNotEqualsSpecifiedOneException)
            (maybe some problems when opened some linear positon but that cannot be handled with InitializeSymbolsHandler)

### Orders creation ###
    @todo По хорошему тут должна быть защита: если ужё всё под стопами - то нельзя создавать
        + может быть job, который будет как-то хитро делать rearrange


### Opposite orders ###
    @todo | oppositeBuyOrder | only if source BuyOrder in chain was with force
    @todo | oppositeBuyOrder | some setting or conditions?
    @todo | oppositeBuyOrder | stop | либо за цену первоначального стопа?
    @todo only if source BuyOrder in chain was with force

### HOT ###
    PriceChange on short period

    use CalculateSignificantPriceChangeHandler for TradingDynamicParameters::safeLiquidationPriceDelta
        ->
            @todo | symbol | for all symbols
            @todo | symbols | TakeProfit trigger delta (and whole mechanics) for all symbols

    exchanges.txt

### priceChange statistics ###
    usage
        @todo | priceChange statistics | ResetBuyOrdersActiveStateHandler | use statistics for get appropriate allowed distance
                                       | ... | ...

### oldCode ###
    data/oldCode/tests

### Opposite STOPS ###
    !!!!      @todo | !!! PredefinedStopLengthParser parameters
        тут возможно какой-то селектор типа day/swing/positioning
        чтобы быть способным поменять поведение
    Не забыть moveStops
    @todo | based on liquidation if position under hedge?
    @todo | some logic for StopCreateStrategy::AFTER_FIRST_POSITION_STOP?
    Посмотреть что со Strategy, когда есть hedge

    @todo | review logic: maybe it must be something like "if (!$ticker->isIndexAlreadyOverStop($side, $basePrice)) $triggerPrice = $side === Side::Sell ? $basePrice + 1 : $basePrice - 1; else $description = 'because index price over stop)';"
    @todo | ShortcutContextProcessorInterface | sL=very-long

### Open position ###
    какой-то поиск максимума на отрезке
    @todo | DRY | with OpenPositionHandler
    @todo | open-position | add triggerDelta?
    @todo | open-position | different logic for support position
    @todo | open-position | full stops grid

    @todo | ATR | research
        ... Ещё нужен какой-то определятор повышена ли в моменте (сегодня или за какой-то период) волатильность
    @todo compare with ATR

    !!!!!!!!!!!! sum.txt !!!!!!!!!!!!!!

### Other ###
    do d:m:d and add constraints
    почему-то в tests/Functional/Bot/Handler/PushOrdersToExchange/BuyOrder/PushBuyOrdersCommonCasesTest.php ордера пушатся от теста к тесту с разной сортировкой

### Technical analysis ###
    after SL (s.281, executed) | skip (liq. is too near [Δ=3441.79,safe=5669.2331632653]) | active
        добавить ещё описание откуда взялись эти числа

    @todo | ta | skipped tests

24.06
    default stops grid definition (long / short ATR)
    либо вообще на основе MS (swing high/low    )


    https://www.mql5.com/ru/articles/1742
        Я использую индикатор RSI с периодом 8

      добавить RSI
        и подумать как его использовать: сколько должно быть диверов перед тем как открывать позицию


25.06
    @todo | ta | !!!обёртка над TraderService!!!





add sleep time




baed on ta:
    liquidation-handler.warningDistancePnlPercent
    liquidation-handler.criticalDistancePnl

~~~~~~~~~~~~!!! REVIEW !!!~~~~~~~~~~~~
        trading.standardAtrForOrdersLength
        и подумать какие Atr для чего использовать
            подходит ли long для significant

    + на максимально грани ( но надо проверить, что нет возможности ликвиднуть )

posSize by TA


stopLoss: вспомнить что там нейронка предлагала по поводу ADX
вариант с входом: быстрый SAR пробивается после signifficantPriceChange + RSI перекуплен перепродан + мб попробовать найти дивер
    + OB/FVG + RSI
        reason: спокойно могут вернуть. И хорошо, если остался запас.
    Второй вариант: не больше опред. риска на сделку! (ограничение на позицию)
        Тогда на возвратах можно делать доборы



openHandler не использует логику StopPlacement


PriceChangeHandler
    Добавить разницу с пред. измерением (...+%)
        И может быть запускать какой-то процесс чека для определённого символа (async)

highlight changed size
    and push it to bottom (if stop executed and PNL increased)
    или даже просто размер увеличился: показывать две итерации внизу


rewrite fix opposite listener
    move to async
        publish from coverLosses (rest loss)



команду для перестановки стопов в б/у


сделать автоматическую раскачку хеджа и депозита (бот сам должен повторить результат)
