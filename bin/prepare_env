#!/bin/sh

PWD=$(pwd)
export ENV_LOCAL_DIST_FILE=$PWD/.env.local.dist
export ENV_LOCAL_FILE=$PWD/.env.local

read_and_replace() {
  read -p "PG_DATABASE_NAME[testnetBot]: " POSTGRES_DATABASE
  POSTGRES_DATABASE=${POSTGRES_DATABASE:-testnetBot}
  read -p "PG_EXTERNAL_NAME[5433]:" POSTGRES_EXTERNAL_PORT
  POSTGRES_EXTERNAL_PORT=${POSTGRES_EXTERNAL_PORT:-5433}
  read -p "BYBIT_API_HOST[api-testnet.bybit.com]:" BYBIT_API_HOST
  BYBIT_API_HOST=${BYBIT_API_HOST:-api-testnet.bybit.com}

  echo $POSTGRES_DATABASE
  echo $POSTGRES_EXTERNAL_PORT
  echo $BYBIT_API_HOST

  sed -i "s/^POSTGRES_DATABASE=.*/POSTGRES_DATABASE=${POSTGRES_DATABASE}/" $ENV_LOCAL_FILE
  sed -i "s/^POSTGRES_EXTERNAL_PORT=.*/POSTGRES_EXTERNAL_PORT=${POSTGRES_EXTERNAL_PORT}/" $ENV_LOCAL_FILE
  sed -i "s/^BYBIT_API_HOST=.*/BYBIT_API_HOST=${BYBIT_API_HOST}/" $ENV_LOCAL_FILE
}

# act
if [ -f "$ENV_LOCAL_FILE" ] ; then
  echo 'Already initialized!';
  else
    cp $ENV_LOCAL_DIST_FILE $ENV_LOCAL_FILE
    read_and_replace
fi
