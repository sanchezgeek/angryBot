#!/bin/bash

count=$1

if [[ -z $count ]]; then
    echo "Specify count";
    exit 0;
fi;

parseSymbol() {
    echo "$1" | grep -oE '\!\][[:space:]]+[A-Z0-9]+' | awk '{print $2}'
}

symbols=()

while IFS= read -r line; do
    symbol=$(parseSymbol "$line")
    symbols+=($symbol)
done < <($(make self-run) bash -c "tail -$count /srv/app/var/log/app_notifications.log")

unique_symbols=$(printf "%s\n" "${symbols[@]}" | sort -u)

for symbol in $unique_symbols
  do
    open "https://www.tradingview.com/chart/7mIOwAJ7/?symbol=BYBIT%3A$symbol.P"
done
