import{u as E,a as ee}from"./index-CPnWkhlj.js";import{d as te,a as oe,u as ae,b as se}from"./useProjects-uJIyuIIU.js";import{_ as L}from"./ProjectStatusBadge.vue_vue_type_script_setup_true_lang-BnaPwg7j.js";import{d as I,L as q,r as n,o as r,c as D,w as i,b as y,A as N,F as M,e as o,f as u,h as k,u as s,j as P,a as A,g as B,i as O,_ as G,k as T,l as le,M as ne}from"./app-CRxPkJhA.js";import{_ as R}from"./UserAvatar.vue_vue_type_script_setup_true_lang-D6-76LK_.js";import{u as re}from"./useModal-CdLpOdnN.js";import{u as ie}from"./useToast-DO9eR350.js";const de={class:"text-[var(--va-secondary)]"},ue={class:"flex flex-col items-center gap-4 grow"},ce={class:"va-h4 text-center self-stretch overflow-hidden line-clamp-2 text-ellipsis"},pe={key:0},me={class:"flex justify-between"},ge={key:1,class:"p-4 flex justify-center items-center text-[var(--va-secondary)]"},ve=I({__name:"ProjectCards",props:{projects:{type:Array,required:!0},loading:{type:Boolean,required:!0}},emits:["edit","delete"],setup(_){const{getUserById:b,getTeamOptions:g}=q("ProjectsPage");return(v,l)=>{const w=n("VaAvatarGroup"),x=n("VaDivider"),c=n("VaButton"),m=n("VaCardContent"),$=n("VaCard"),a=n("VaInnerLoading");return _.projects.length>0||_.loading?(r(),D(a,{key:0,loading:_.loading,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 min-h-[4rem]"},{default:i(()=>[(r(!0),y(M,null,N(_.projects,t=>(r(),D($,{key:t.project_name,style:{"--va-card-outlined-border":"1px solid var(--va-background-element)"},outlined:""},{default:i(()=>[o(m,{class:"flex flex-col h-full"},{default:i(()=>[u("div",de,k(new Date(t.created_at).toLocaleDateString()),1),u("div",ue,[u("h4",ce,k(t.project_name),1),u("p",null,[l[0]||(l[0]=u("span",{class:"text-[var(--va-secondary)]"},"Owner: ",-1)),s(b)(t.project_owner)?(r(),y("span",pe,k(s(b)(t.project_owner).fullname),1)):P("",!0)]),o(w,{class:"my-4",options:s(g)(t.team),max:5},null,8,["options"]),o(L,{status:t.status},null,8,["status"])]),o(x,{class:"my-6"}),u("div",me,[o(c,{preset:"secondary",icon:"mso-edit",color:"secondary",onClick:j=>v.$emit("edit",t)},null,8,["onClick"]),o(c,{preset:"secondary",icon:"mso-delete",color:"danger",onClick:j=>v.$emit("delete",t)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["loading"])):(r(),y("div",ge,"No projects"))}}}),fe={class:"ellipsis max-w-[230px] lg:max-w-[450px]"},ye={key:0,class:"flex items-center gap-2 ellipsis max-w-[230px]"},_e={class:"flex gap-2 justify-end"},be={class:"flex flex-col-reverse md:flex-row gap-2 justify-between items-center py-2"},je={key:0,class:"flex"},Ve=I({__name:"ProjectsTable",props:{projects:{type:Array,required:!0},loading:{type:Boolean,required:!0},sortBy:{type:String,default:void 0},sortingOrder:{type:String,default:void 0},pagination:{type:Object,required:!0}},emits:["edit","delete"],setup(_,{emit:b}){const g=te([{label:"Project name",key:"project_name",sortable:!0},{label:"Project owner",key:"project_owner",sortable:!0},{label:"Team",key:"team",sortable:!0},{label:"Status",key:"status",sortable:!0},{label:"Creation Date",key:"created_at",sortable:!0},{label:" ",key:"actions"}]),v=_,l=b,w=E(v,"sortBy",l),x=E(v,"sortingOrder",l),c=A(()=>Math.ceil(v.pagination.total/v.pagination.perPage)),{getUserById:m,getTeamOptions:$}=q("ProjectsPage");return(a,t)=>{const j=n("VaAvatarGroup"),p=n("VaButton"),U=n("VaDataTable"),h=n("VaSelect"),S=n("VaPagination");return r(),y("div",null,[o(U,{"sort-by":s(w),"onUpdate:sortBy":t[0]||(t[0]=e=>O(w)?w.value=e:null),"sorting-order":s(x),"onUpdate:sortingOrder":t[1]||(t[1]=e=>O(x)?x.value=e:null),items:_.projects,columns:s(g),loading:_.loading},{"cell(project_name)":i(({rowData:e})=>[u("div",fe,k(e.project_name),1)]),"cell(project_owner)":i(({rowData:e})=>[s(m)(e.project_owner)?(r(),y("div",ye,[o(R,{user:s(m)(e.project_owner),size:"small"},null,8,["user"]),B(" "+k(s(m)(e.project_owner).fullname),1)])):P("",!0)]),"cell(team)":i(({rowData:e})=>[o(j,{size:"small",options:s($)(e.team),max:5},null,8,["options"])]),"cell(status)":i(({rowData:e})=>[o(L,{status:e.status},null,8,["status"])]),"cell(created_at)":i(({rowData:e})=>[B(k(new Date(e.created_at).toLocaleDateString()),1)]),"cell(actions)":i(({rowData:e})=>[u("div",_e,[o(p,{preset:"primary",size:"small",color:"primary",icon:"mso-edit","aria-label":"Edit project",onClick:C=>a.$emit("edit",e)},null,8,["onClick"]),o(p,{preset:"primary",size:"small",icon:"mso-delete",color:"danger","aria-label":"Delete project",onClick:C=>a.$emit("delete",e)},null,8,["onClick"])])]),_:1},8,["sort-by","sorting-order","items","columns","loading"]),u("div",be,[u("div",null,[u("b",null,k(a.$props.pagination.total)+" results.",1),t[6]||(t[6]=B(" Results per page ")),o(h,{modelValue:a.$props.pagination.perPage,"onUpdate:modelValue":t[2]||(t[2]=e=>a.$props.pagination.perPage=e),class:"!w-20",options:[10,50,100]},null,8,["modelValue"])]),c.value>1?(r(),y("div",je,[o(p,{preset:"secondary",icon:"va-arrow-left","aria-label":"Previous page",disabled:a.$props.pagination.page===1,onClick:t[3]||(t[3]=e=>a.$props.pagination.page--)},null,8,["disabled"]),o(p,{class:"mr-2",preset:"secondary",icon:"va-arrow-right","aria-label":"Next page",disabled:a.$props.pagination.page===c.value,onClick:t[4]||(t[4]=e=>a.$props.pagination.page++)},null,8,["disabled"]),o(S,{modelValue:a.$props.pagination.page,"onUpdate:modelValue":t[5]||(t[5]=e=>a.$props.pagination.page=e),"buttons-preset":"secondary",pages:c.value,"visible-pages":5,"boundary-links":!1,"direction-links":!1},null,8,["modelValue","pages"])])):P("",!0)])])}}}),ke=G(Ve,[["__scopeId","data-v-b93c3aed"]]),we={class:"flex justify-end flex-col-reverse sm:flex-row mt-4 gap-2"},xe=I({__name:"EditProjectForm",props:{project:{},saveButtonLabel:{}},emits:["save","close"],setup(_,{expose:b}){const g=_,v={project_name:"",project_owner:void 0,team:[],status:void 0},l=T({...v}),w=A(()=>Object.keys(l.value).some(a=>{var t;return a==="team"?!1:l.value[a]!==((t=g.project??v)==null?void 0:t[a])}));b({isFormHasUnsavedChanges:w});const x=oe();le(()=>g.project,()=>{g.project&&(l.value={...g.project,project_owner:g.project.project_owner})},{immediate:!0});const c=a=>!!a||"This field is required",m=T(""),$=T("");return(a,t)=>{const j=n("VaInput"),p=n("VaSelect"),U=n("VaButton"),h=n("VaForm");return r(),D(h,{class:"flex flex-col gap-2"},{default:i(({validate:S})=>[o(j,{modelValue:l.value.project_name,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value.project_name=e),label:"Project name",rules:[c]},null,8,["modelValue","rules"]),o(p,{modelValue:l.value.project_owner,"onUpdate:modelValue":t[1]||(t[1]=e=>l.value.project_owner=e),search:m.value,"onUpdate:search":t[2]||(t[2]=e=>m.value=e),searchable:"",label:"Owner","text-by":"fullname","track-by":"id","value-by":"id",rules:[c],options:s(x).items},{content:i(({value:e})=>[e?(r(),y("div",{key:e.id,class:"flex items-center gap-1 mr-4"},[P("",!0),B(" "+k(e.fullname),1)])):P("",!0)]),_:1},8,["modelValue","search","rules","options"]),o(p,{modelValue:l.value.team,"onUpdate:modelValue":t[3]||(t[3]=e=>l.value.team=e),search:$.value,"onUpdate:search":t[4]||(t[4]=e=>$.value=e),label:"Team","text-by":"fullname","track-by":"id","value-by":"id",multiple:"",rules:[e=>"length"in e&&e.length>0||"This field is required"],options:s(x).items,"max-visible-options":a.$vaBreakpoint.mdUp?3:1},{content:i(({valueArray:e})=>[e!=null&&e.length?(r(!0),y(M,{key:0},N(e,(C,F)=>(r(),y("div",{key:C.id,class:"flex items-center gap-1 mr-2"},[C?(r(),D(R,{key:0,user:C,size:"18px"},null,8,["user"])):P("",!0),B(" "+k(C.fullname)+k(F<e.length-1?",":""),1)]))),128)):P("",!0)]),_:1},8,["modelValue","search","rules","options","max-visible-options"]),o(p,{modelValue:l.value.status,"onUpdate:modelValue":t[5]||(t[5]=e=>l.value.status=e),label:"Status",rules:[c],"track-by":"value","value-by":"value",options:[{text:"In progress",value:"in progress"},{text:"Archived",value:"archived"},{text:"Completed",value:"completed"},{text:"Important",value:"important"}]},{content:i(({value:e})=>[e?(r(),D(L,{key:0,status:e.value},null,8,["status"])):P("",!0)]),_:1},8,["modelValue","rules"]),u("div",we,[o(U,{preset:"secondary",color:"secondary",onClick:t[6]||(t[6]=e=>a.$emit("close"))},{default:i(()=>t[7]||(t[7]=[B("Cancel")])),_:1}),o(U,{onClick:e=>S()&&a.$emit("save",l.value)},{default:i(()=>[B(k(a.saveButtonLabel),1)]),_:2},1032,["onClick"])])]),_:1})}}}),Ce=G(xe,[["__scopeId","data-v-6abead9d"]]),$e={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},Pe={class:"flex flex-col md:flex-row gap-2 justify-start"},Be={key:0,class:"va-h5 mb-4"},Ue={key:1,class:"va-h5 mb-4"},Le=I({__name:"ProjectsPage",setup(_){const b=ee("projects-view",!0),{projects:g,update:v,add:l,isLoading:w,remove:x,pagination:c,sorting:m}=ae(),{users:$,getTeamOptions:a,getUserById:t}=se();ne("ProjectsPage",{users:$,getTeamOptions:a,getUserById:t});const j=T(null),p=T(!1),U=f=>{j.value=f,p.value=!0},h=()=>{j.value=null,p.value=!0},{init:S}=ie(),e=async f=>{p.value=!1,"id"in f?(await v(f),S({message:"Project updated",color:"success"})):(await l(f),S({message:"Project created",color:"success"}))},{confirm:C}=re(),F=async f=>{await C({title:"Delete project",message:`Are you sure you want to delete project "${f.project_name}"?`,okText:"Delete",size:"small",maxWidth:"380px"})&&(await x(f),S({message:"Project deleted",color:"success"}))},z=T(),H=async f=>{z.value.isFormHasUnsavedChanges?await C({maxWidth:"380px",message:"Form has unsaved changes. Are you sure you want to close it?",size:"small"})&&f():f()};return(f,d)=>{const W=n("VaButtonToggle"),J=n("VaButton"),K=n("VaCardContent"),Q=n("VaModal"),X=n("VaCard");return r(),y(M,null,[d[6]||(d[6]=u("h1",{class:"page-title"},"Projects",-1)),o(X,null,{default:i(()=>[o(K,null,{default:i(()=>[u("div",$e,[u("div",Pe,[o(W,{modelValue:s(b),"onUpdate:modelValue":d[0]||(d[0]=V=>O(b)?b.value=V:null),color:"background-element","border-color":"background-element",options:[{label:"Cards",value:!0},{label:"Table",value:!1}]},null,8,["modelValue"])]),o(J,{icon:"add",onClick:h},{default:i(()=>d[5]||(d[5]=[B("Project")])),_:1})]),s(b)?(r(),D(ve,{key:0,projects:s(g),loading:s(w),onEdit:U,onDelete:F},null,8,["projects","loading"])):(r(),D(ke,{key:1,"sort-by":s(m).sortBy,"onUpdate:sortBy":d[1]||(d[1]=V=>s(m).sortBy=V),"sorting-order":s(m).sortingOrder,"onUpdate:sortingOrder":d[2]||(d[2]=V=>s(m).sortingOrder=V),pagination:s(c),"onUpdate:pagination":d[3]||(d[3]=V=>O(c)?c.value=V:null),projects:s(g),loading:s(w),onEdit:U,onDelete:F},null,8,["sort-by","sorting-order","pagination","projects","loading"]))]),_:1}),o(Q,{modelValue:p.value,"onUpdate:modelValue":d[4]||(d[4]=V=>p.value=V),size:"small","mobile-fullscreen":"","close-button":"",stateful:"","hide-default-actions":"","before-cancel":H},{default:i(({cancel:V,ok:Y})=>[j.value===null?(r(),y("h1",Be,"Add project")):(r(),y("h1",Ue,"Edit project")),o(Ce,{ref_key:"editFormRef",ref:z,project:j.value,"save-button-label":j.value===null?"Add":"Save",onClose:V,onSave:Z=>{e(Z),Y()}},null,8,["project","save-button-label","onClose","onSave"])]),_:1},8,["modelValue"])]),_:1})],64)}}});export{Le as default};
