import{K as U,k as m,l as x,a as S,u as w}from"./app-CRxPkJhA.js";const Q=e=>e,y=void 0,g={allUsers:()=>`${y}/users`,user:e=>`${y}/users/${e}`,users:({page:e,pageSize:t})=>`${y}/users/?page=${e}&pageSize=${t}`,allProjects:()=>`${y}/projects`,project:e=>`${y}/projects/${e}`,projects:({page:e,pageSize:t})=>`${y}/projects/?page=${e}&pageSize=${t}`,avatars:()=>`${y}/avatars`},O=async e=>{const t=await fetch(g.allProjects()).then(a=>a.json());return{data:t,pagination:{page:e.page,perPage:e.perPage,total:t.length}}},T=async e=>{const t=new Headers;return t.append("Content-Type","application/json"),fetch(g.allProjects(),{method:"POST",body:JSON.stringify(e),headers:t}).then(a=>a.json())},$=async e=>{const t=new Headers;return t.append("Content-Type","application/json"),fetch(g.project(e.id),{method:"PUT",body:JSON.stringify(e),headers:t}).then(a=>a.json())},A=async e=>fetch(g.project(e.id),{method:"DELETE"}),D=U("projects",{state:()=>({items:[],pagination:{page:1,perPage:10,total:0}}),actions:{async getAll(e){const{data:t,pagination:a}=await O({...e.sorting,...e.pagination});this.items=t,this.pagination=a},async add(e){const[t]=await T(e);this.items.push(t)},async update(e){const[t]=await $(e),a=this.items.findIndex(({id:n})=>n===e.id);this.items.splice(a,1,t)},async remove(e){if(await A(e)){const a=this.items.findIndex(({id:n})=>n===e.id);this.items.splice(a,1)}}}}),c=[];for(let e=0;e<256;++e)c.push((e+256).toString(16).slice(1));function I(e,t=0){return(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase()}let j;const R=new Uint8Array(16);function C(){if(!j){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");j=crypto.getRandomValues.bind(crypto)}return j(R)}const E=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),P={randomUUID:E};function k(e,t,a){if(P.randomUUID&&!t&&!e)return P.randomUUID();e=e||{};const n=e.random||(e.rng||C)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,I(n)}const L=async e=>{const{isActive:t,search:a}=e;let n=await fetch(g.allUsers()).then(r=>r.json());n=n.filter(r=>r.active===t),a&&(n=n.filter(r=>r.fullname.toLowerCase().includes(a.toLowerCase())));const{page:i=1,perPage:s=10}=e||{};return{data:n,pagination:{page:i,perPage:s,total:n.length}}},B=async e=>{const t=new Headers;t.append("Content-Type","application/json");const a=await fetch(g.allUsers(),{method:"POST",body:JSON.stringify(e),headers:t}).then(n=>n.json());if(!a.error)return a;throw new Error(a.error)},F=async e=>{const t=new Headers;t.append("Content-Type","application/json");const a=await fetch(g.user(e.id),{method:"PUT",body:JSON.stringify(e),headers:t}).then(n=>n.json());if(!a.error)return a;throw new Error(a.error)},b=async e=>fetch(g.user(e.id),{method:"DELETE"}),H=async e=>fetch(g.avatars(),{method:"POST",body:e,redirect:"follow"}).then(t=>t.json()),V=U("users",{state:()=>({items:[],pagination:{page:1,perPage:10,total:0}}),actions:{async getAll(e){const{data:t,pagination:a}=await L({...e.filters,...e.sorting,...e.pagination});this.items=t,this.pagination=a},async add(e){const[t]=await B(e);return this.items.unshift(t),t},async update(e){const[t]=await F(e),a=this.items.findIndex(({id:n})=>n===e.id);return this.items.splice(a,1,t),t},async remove(e){if(await b(e)){const a=this.items.findIndex(({id:n})=>n===e.id);this.items.splice(a,1)}},async uploadAvatar(e){return H(e)}}}),J=()=>m({page:1,perPage:10,total:0}),N=()=>m({sortBy:"fullname",sortingOrder:null}),_=()=>m({isActive:!0,search:""}),z=e=>{const t=m(!1),a=m(),n=V(),{filters:i=_(),sorting:s=N(),pagination:r=J()}={},d=async()=>{t.value=!0;try{await n.getAll({filters:w(i),sorting:w(s),pagination:w(r)}),r.value=n.pagination}finally{t.value=!1}};x(i,()=>{r.value.page=1,d()},{deep:!0}),d();const p=S(()=>{const l=(u,v)=>v==="projects"?u.projects.map(f=>f).join(", "):u[v],o=n.items.slice((r.value.page-1)*r.value.perPage,r.value.page*r.value.perPage);return s.value.sortBy&&s.value.sortingOrder&&o.sort((u,v)=>{const f=l(u,s.value.sortBy),h=l(v,s.value.sortBy);return f>h?s.value.sortingOrder==="asc"?1:-1:f<h?s.value.sortingOrder==="asc"?-1:1:0}),o});return{error:a,isLoading:t,filters:i,sorting:s,pagination:r,users:p,fetch:d,async add(l){t.value=!0;try{return await n.add(l)}catch(o){a.value=o}finally{t.value=!1}},async update(l){t.value=!0;try{return await n.update(l)}catch(o){a.value=o}finally{t.value=!1}},async remove(l){t.value=!0;try{return await n.remove(l)}catch(o){a.value=o}finally{t.value=!1}},async uploadAvatar(l){const o=new FormData;return o.append("avatar",l),o.append("id",k()),n.uploadAvatar(o)}}};function K(){const{users:e}=z(),t=i=>e.value.find(({id:s})=>i===s),a=i=>{const s=["primary","#FFD43A","#ADFF00","#262824","danger"],r=i.charCodeAt(0)%s.length;return s[r]};return{users:e,getUserById:t,getTeamOptions:i=>i.reduce((s,r)=>{const d=t(r);return d&&s.push({label:d.fullname,src:d.avatar,fallbackText:d.fullname[0],color:a(d.fullname)}),s},[])}}const q=()=>m({page:1,perPage:10,total:0}),G=()=>m({sortBy:"created_at",sortingOrder:"desc"}),W=e=>{const t=m(!1),a=D(),{getUserById:n}=K(),{sorting:i=G(),pagination:s=q()}=e??{},r=async()=>{t.value=!0,await a.getAll({sorting:w(i),pagination:w(s)}),s.value=a.pagination,t.value=!1},d=S(()=>{const p=a.items.slice((s.value.page-1)*s.value.perPage,s.value.page*s.value.perPage),l=(o,u)=>{var v;return u==="project_owner"?(v=n(o.project_owner))==null?void 0:v.fullname:u==="team"?o.team.map(f=>{var h;return((h=n(f))==null?void 0:h.fullname)||""}).join(", "):u==="created_at"?new Date(o[u]):o[u]};return i.value.sortBy&&i.value.sortingOrder&&p.sort((o,u)=>(o=l(o,i.value.sortBy),u=l(u,i.value.sortBy),o<u?i.value.sortingOrder==="asc"?-1:1:o>u?i.value.sortingOrder==="asc"?1:-1:0)),p});return r(),{isLoading:t,projects:d,fetch:r,async add(p){t.value=!0,await a.add(p),await r(),t.value=!1},async update(p){t.value=!0,await a.update(p),await r(),t.value=!1},async remove(p){t.value=!0,await a.remove(p),await r(),t.value=!1},pagination:s,sorting:i}};export{V as a,K as b,z as c,Q as d,W as u,k as v};
